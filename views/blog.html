<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>CCCF</title>
    <link rel='stylesheet' href='/css/style.css' />
    <link rel='stylesheet' href='/css/header.css'>
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/blog.css">
    <script>
        fetch('/header.html')
            .then(res => res.text())
            .then(async data => {
                document.querySelector('#header-container').innerHTML = data;
                await import('/script/header.js');
            });
        fetch('/footer.html')
            .then(res => res.text())
            .then(async data => {
                document.querySelector('#footer-container').innerHTML = data;
                await import("/script/footer.js");
            });
            
        const id = window.location.pathname.split("/").pop();
        fetch(`/api/blog/${id}`)
            .then(res => res.json())
            .then(data => {
                console.log(data)
                const container = document.querySelector(".container")
                if (data.error) {
                    const error = document.createElement("div")
                    error.className = "error";
                    error.innerText = "404: No Content";
                    container.appendChild(error);
                }
                else {
                    const details = data.details[0]
                    const hero = document.createElement("div")
                    hero.className = "blog-hero"

                    const postInfo = document.createElement("div")
                    postInfo.className = "post-info"
                    const title = document.createElement("h1")
                    title.innerText = details.title
                    const author = document.createElement("h2")
                    if (details.author)
                        author.innerText = details.author.name
                    const publishedAt = document.createElement("p")
                    if (details.publishedAt)
                        publishedAt.innerText = details.publishedAt.split("T")[0]
                    const categories = document.createElement("div")
                    categories.className = "categories"
                    if (details.categories)
                        for (category of details.categories) {
                            const div = document.createElement("div")
                            div.innerText = category.title
                            categories.appendChild(div)
                        }
                    postInfo.appendChild(title)
                    postInfo.appendChild(author)
                    postInfo.appendChild(publishedAt)
                    postInfo.appendChild(categories)

                    hero.appendChild(postInfo)

                    const poster = document.createElement("img")
                    poster.src = details.poster
                    hero.appendChild(poster)

                    const body = document.createElement("div")
                    body.className = "blog-body"
                    body.innerHTML = data.content;

                    container.appendChild(hero)
                    container.appendChild(body)
                }
            })
    </script>
    <script src='/script/home.js' defer></script>
</head>
<body>
    <div id='header-container'></div>

    <div class="container">
        
    </div>

    <div class="end-ruler">
        <div></div>
    </div>

    <div id='footer-container'></div>
</body>
</html>